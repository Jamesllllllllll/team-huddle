# TanStack Features Usage in Team Huddle Live

This document analyzes how Team Huddle Live uses (or doesn't use) features from TanStack Router, TanStack Query, and TanStack Start.

---

## TanStack Router Features

### ✅ Features Currently Used

#### 1. **100% Inferred TypeScript Support**
**Status:** ✅ Fully Utilized

The app leverages TanStack Router's type inference throughout:
- Route definitions use `createFileRoute` with typed path parameters (e.g., `/huddles/$huddleSlug`)
- Navigation calls are fully typed: `router.navigate({ to: '/huddles/$huddleSlug', params: { huddleSlug: slug } })`
- Route context is typed: `createRootRouteWithContext<{ queryClient: QueryClient }>()`
- Path parameters are accessed with type safety: `Route.useParams()` returns typed `{ huddleSlug: string }`

**Location:** 
- ```47:59:src/router.tsx``` - Router configuration with typed context
- ```6:18:src/routes/huddles.$huddleSlug.tsx``` - Typed route with path params
- ```99:102:src/routes/index.tsx``` - Typed navigation calls

#### 2. **File-based Route Generation**
**Status:** ✅ Fully Utilized

The app uses file-based routing exclusively:
- Routes are defined in `src/routes/` directory
- `routeTree.gen.ts` is auto-generated by TanStack Router's Vite plugin
- Routes follow the pattern: `__root.tsx`, `index.tsx`, `huddles.$huddleSlug.tsx`
- The router is configured with the generated `routeTree`

**Location:**
- ```15:15:vite.config.ts``` - `tanstackStart()` plugin enables file-based routing
- ```11:11:src/router.tsx``` - Uses generated `routeTree`
- ```1:87:src/routeTree.gen.ts``` - Auto-generated route tree

#### 3. **Nested Routing and Layout Routes**
**Status:** ✅ Used (Simple Structure)

The app uses a simple nested structure:
- Root route (`__root.tsx`) provides the layout with header, navigation, and global providers
- Child routes (`index.tsx`, `huddles.$huddleSlug.tsx`) render within the root layout via `<Outlet />`
- The root route wraps children with `UserProfileProvider` and provides global UI chrome

**Location:**
- ```74:81:src/routes/__root.tsx``` - Root component with `<Outlet />`
- ```60:63:src/routes/index.tsx``` - Child route definition
- ```6:18:src/routes/huddles.$huddleSlug.tsx``` - Child route definition

#### 4. **Built-in Route Loaders with SWR Caching**
**Status:** ⚠️ Partially Used

The app uses route loaders, but only on one route:
- `/huddles/$huddleSlug` has a loader that prefetches huddle data using `queryClient.ensureQueryData`
- The loader redirects to `/` if the huddle doesn't exist
- The root route (`/`) does NOT have a loader; it relies on client-side `useSuspenseQuery`

**Location:**
- ```9:17:src/routes/huddles.$huddleSlug.tsx``` - Loader implementation
- ```60:63:src/routes/index.tsx``` - No loader (uses client-side suspense)

#### 5. **Designed for Client-side Data Caches (TanStack Query)**
**Status:** ✅ Fully Utilized

The router is tightly integrated with TanStack Query:
- Router context includes `queryClient` for use in loaders
- `setupRouterSsrQueryIntegration` connects router and query client for SSR
- Loaders use `queryClient.ensureQueryData` to prefetch queries
- Components use `useSuspenseQuery` for data fetching

**Location:**
- ```52:52:src/router.tsx``` - Router context with `queryClient`
- ```60:63:src/router.tsx``` - SSR query integration setup
- ```9:12:src/routes/huddles.$huddleSlug.tsx``` - Loader using queryClient
- ```70:70:src/routes/index.tsx``` - Component using `useSuspenseQuery`

#### 6. **Automatic Route Prefetching**
**Status:** ✅ Configured

The router is configured with `defaultPreload: 'intent'`, which means routes prefetch when the user hovers over or focuses on links.

**Location:**
- ```49:49:src/router.tsx``` - `defaultPreload: 'intent'` configuration

#### 7. **Asynchronous Route Elements and Error Boundaries**
**Status:** ✅ Used

- Routes use `pendingComponent` for loading states
- Root route defines `errorComponent` and `notFoundComponent`
- Default error boundary (`DefaultCatchBoundary`) is configured globally

**Location:**
- ```50:51:src/router.tsx``` - Default error and not found components
- ```63:63:src/routes/index.tsx``` - Route-specific `pendingComponent`
- ```8:8:src/routes/huddles.$huddleSlug.tsx``` - Route-specific `pendingComponent`
- ```63:68:src/routes/__root.tsx``` - Root error component

#### 8. **Typesafe Navigation**
**Status:** ✅ Fully Utilized

All navigation is type-safe:
- `Link` components use typed `to` and `params` props
- `router.navigate()` calls are fully typed
- TypeScript will catch invalid routes or missing parameters

**Location:**
- ```309:313:src/routes/index.tsx``` - Typed `Link` component
- ```99:102:src/routes/index.tsx``` - Typed `router.navigate()` call
- ```127:130:src/routes/index.tsx``` - Another typed navigation example

#### 9. **Inherited Route Context**
**Status:** ✅ Used

The root route provides context (`queryClient`) that is inherited by all child routes:
- Root route defines context type: `createRootRouteWithContext<{ queryClient: QueryClient }>()`
- Child route loaders access context: `loader: async ({ context: { queryClient } }) => ...`
- Context is fully typed and inferred

**Location:**
- ```22:24:src/routes/__root.tsx``` - Root context definition
- ```9:9:src/routes/huddles.$huddleSlug.tsx``` - Loader accessing context

#### 10. **Scroll Restoration**
**Status:** ✅ Enabled

The router has `scrollRestoration: true` configured.

**Location:**
- ```58:58:src/router.tsx``` - Scroll restoration enabled

#### 11. **Route Head/Metadata Management**
**Status:** ✅ Used (Root Only)

The root route defines head metadata (meta tags, links) via the `head` function. Child routes do not define their own head metadata.

**Location:**
- ```25:62:src/routes/__root.tsx``` - Root route head configuration

---

### ❌ Features NOT Currently Used

#### 1. **Search Parameters (1st Class Feature)**
**Status:** ❌ Not Used

The app does NOT use TanStack Router's powerful search parameter features:
- No `validateSearch` schemas defined
- No `useSearch` hooks for managing search param state
- No search param navigation APIs
- No custom search param parsers/serializers
- No search param middleware

**Impact:** The app misses out on a powerful state management feature. Search params could be used for:
- Filtering huddles by status
- Storing UI state (selected view, sort order)
- Sharing filtered/selected states via URL
- Deep linking to specific planning items

#### 2. **Path and Search Parameter Schema Validation**
**Status:** ❌ Not Used

While path params are typed, there's no runtime validation using Zod or similar. Search params aren't used at all.

#### 3. **Custom Search Param Parser/Serializer Support**
**Status:** ❌ Not Used

No custom parsers or serializers are configured.

#### 4. **Search Param Middleware**
**Status:** ❌ Not Used

No search param middleware is configured.

#### 5. **Route Matching/Loading Middleware**
**Status:** ❌ Not Used

No `beforeLoad` hooks or route middleware are used.

#### 6. **Loader Dependencies (`loaderDeps`)**
**Status:** ❌ Not Used

The loader in `huddles.$huddleSlug.tsx` doesn't use `loaderDeps` to reactively reload when dependencies change.

#### 7. **Deferred Data Loading**
**Status:** ❌ Not Used

No use of `defer()` or `<Await>` for progressive streaming of data. All data loads synchronously.

#### 8. **Route Masking**
**Status:** ❌ Not Used

No route masking is implemented.

#### 9. **Mixed File-based and Code-based Routing**
**Status:** ❌ Not Used

The app uses only file-based routing. No code-based routes are defined.

#### 10. **Per-Route Head Metadata**
**Status:** ⚠️ Partially Used

Only the root route defines head metadata. Child routes (like `/huddles/$huddleSlug`) could define their own head metadata for SEO and dynamic titles, but they don't.

---

## TanStack Query Features

### ✅ Features Currently Used

#### 1. **Query Client Integration**
**Status:** ✅ Fully Utilized

The app creates a `QueryClient` with custom configuration:
- Custom `queryKeyHashFn` and `queryFn` from Convex integration
- `MutationCache` with error handling (toast notifications)
- Connected to Convex via `@convex-dev/react-query`

**Location:**
- ```32:44:src/router.tsx``` - QueryClient configuration

#### 2. **Suspense Queries**
**Status:** ✅ Used

Components use `useSuspenseQuery` for data fetching:
- Home route uses `useSuspenseQuery(huddleQueries.list())`
- This pairs with route `pendingComponent` for loading states

**Location:**
- ```70:70:src/routes/index.tsx``` - `useSuspenseQuery` usage

#### 3. **Mutations**
**Status:** ✅ Fully Utilized

The app uses mutations extensively:
- Custom hooks wrap `useConvexMutation` with `useMutation`
- Mutations handle huddle CRUD, participant management, planning items, presence, etc.
- Error handling via `MutationCache` shows toast notifications

**Location:**
- ```13:71:src/queries.ts``` - All mutation hooks
- ```39:43:src/router.tsx``` - Mutation error handling

#### 4. **Query Invalidation**
**Status:** ✅ Used

The app invalidates queries after mutations:
- `queryClient.invalidateQueries()` is called after reset operations
- Convex's reactive queries automatically update when data changes

**Location:**
- ```210:210:src/routes/index.tsx``` - Query invalidation example

#### 5. **SSR Integration**
**Status:** ✅ Configured

`setupRouterSsrQueryIntegration` connects TanStack Router with TanStack Query for SSR:
- Ensures queries are prefetched server-side
- Hydrates client-side cache

**Location:**
- ```60:63:src/router.tsx``` - SSR integration setup

#### 6. **Query Devtools**
**Status:** ✅ Enabled in Development

React Query Devtools are included in the root component for development.

**Location:**
- ```111:111:src/routes/__root.tsx``` - Devtools in dev mode

#### 7. **Online Manager**
**Status:** ✅ Used

The app uses `onlineManager` from TanStack Query to detect offline/online status and show toast notifications.

**Location:**
- ```1:21:src/hooks/useOfflineIndicator.tsx``` - Online manager usage

#### 8. **Notify Manager Scheduler**
**Status:** ✅ Configured

The router configures `notifyManager.setScheduler(window.requestAnimationFrame)` for optimized updates.

**Location:**
- ```18:18:src/router.tsx``` - Scheduler configuration

---

### ❌ Features NOT Currently Used

#### 1. **Query Prefetching APIs**
**Status:** ⚠️ Partially Used

While `ensureQueryData` is used in loaders, the app doesn't use:
- `prefetchQuery` for proactive prefetching
- `prefetchInfiniteQuery` for pagination
- Manual prefetching on hover/focus (relies on router's `defaultPreload`)

#### 2. **Infinite Queries**
**Status:** ❌ Not Used

No infinite queries for pagination. Huddles list loads all data at once.

#### 3. **Optimistic Updates**
**Status:** ❌ Not Used

Mutations don't use optimistic updates. The UI waits for server confirmation before updating.

**Impact:** Could improve perceived performance for actions like editing planning items.

#### 4. **Query Selectors**
**Status:** ❌ Not Used

No fine-grained selectors for partial data subscriptions. Components subscribe to entire query results.

#### 5. **Query Placeholders**
**Status:** ❌ Not Used

No placeholder data for queries.

#### 6. **Query Retry Logic**
**Status:** ⚠️ Uses Defaults

No custom retry logic configured. Uses TanStack Query's default retry behavior.

#### 7. **Query Stale Time Configuration**
**Status:** ⚠️ Uses Defaults

No custom `staleTime` or `gcTime` configured per query. Uses defaults.

#### 8. **Parallel Queries**
**Status:** ⚠️ Not Explicitly Optimized

While multiple queries can run, there's no explicit parallel query optimization or coordination.

---

## TanStack Start Features

### ✅ Features Currently Used

#### 1. **Server Functions (`createServerFn`)**
**Status:** ✅ Fully Utilized

The app uses `createServerFn` extensively for server-side operations:
- Avatar uploads and generation (`uploadAvatarFromBase64`, `generateAvatarImage`)
- OpenAI transcript analysis (`requestTranscriptAnalysis`)
- Huddle title generation (`requestHuddleAutoTitle`)
- Realtime session creation (`createRealtimeClientSecret`)
- Speaking to huddle (`speakToHuddle`)

**Location:**
- ```176:176:src/server/avatar.ts``` - Avatar upload server function
- ```200:200:src/server/avatar.ts``` - Avatar generation server function
- ```27:27:src/server/ai/transcriptAnalysis.ts``` - Transcript analysis server function
- ```95:95:src/server/generateHuddleTitle.ts``` - Title generation server function
- ```25:25:src/server/createRealtimeSession.ts``` - Realtime session server function
- ```410:410:src/server/speakToHuddle.ts``` - Speak to huddle server function

#### 2. **File-based Route Generation (via Vite Plugin)**
**Status:** ✅ Fully Utilized

The `tanstackStart()` Vite plugin generates routes from the file system.

**Location:**
- ```15:15:vite.config.ts``` - TanStack Start plugin

#### 3. **SSR Support**
**Status:** ✅ Configured

The app is configured for SSR:
- Router has SSR query integration
- Server functions run on the server
- Route tree generation includes SSR types

**Location:**
- ```81:86:src/routeTree.gen.ts``` - SSR type registration
- ```60:63:src/router.tsx``` - SSR query integration

#### 4. **Server Function Validation**
**Status:** ✅ Used

Server functions use Zod for input validation:
- Avatar uploads validate base64, mimeType, filename, source
- Transcript analysis validates payloads
- All server functions have typed, validated inputs

**Location:**
- ```8:13:src/server/avatar.ts``` - Zod validation schemas
- Server functions throughout `src/server/` use validation

---

### ❌ Features NOT Currently Used

#### 1. **Streaming Responses**
**Status:** ❌ Not Used

Server functions return standard responses. No streaming via `ReadableStream` or progressive data loading.

**Impact:** The enhancement plan notes this as a future opportunity for streaming transcript analysis and AI reasoning.

#### 2. **Deferred Data Loading**
**Status:** ❌ Not Used

No use of `defer()` in loaders for progressive rendering. All data loads synchronously.

#### 3. **Route-level Streaming**
**Status:** ❌ Not Used

No streaming at the route level. Routes render fully after all data loads.

#### 4. **Server Actions (Alternative to Server Functions)**
**Status:** ❌ Not Used

The app uses `createServerFn` exclusively. No server actions pattern.

#### 5. **Server-only Routes/API Routes**
**Status:** ❌ Not Used

No server-only API routes defined. All server logic is in server functions.

#### 6. **Progressive Enhancement**
**Status:** ⚠️ Partial

While SSR is configured, the app doesn't use progressive enhancement patterns like:
- Form actions that work without JavaScript
- Progressive image loading
- Incremental route rendering

---

## Summary

### Well-Utilized Features

1. **TypeScript Inference** - Excellent use of type safety throughout routing and navigation
2. **File-based Routing** - Clean, maintainable route structure
3. **Server Functions** - Extensive use for server-side operations with validation
4. **Query Integration** - Good integration between Router and Query for data fetching
5. **Error Boundaries** - Proper error handling at route level
6. **Context Inheritance** - Effective use of route context for sharing queryClient

### Underutilized Features

1. **Search Parameters** - Completely unused, missing a powerful state management tool
2. **Route Loaders** - Only one route has a loader; home route uses client-side suspense
3. **Deferred/Streaming** - No progressive data loading or streaming
4. **Optimistic Updates** - Mutations don't update UI optimistically
5. **Per-Route Head Metadata** - Only root route defines head; child routes could benefit
6. **Loader Dependencies** - Loaders don't reactively reload when dependencies change
7. **Query Selectors** - No fine-grained data subscriptions

### Recommendations

Based on the enhancement plan document (`docs/tanstack-start-enhancement-plan.md`), the team is already aware of many opportunities:

1. **Add route loaders** to `/` for SSR prefetching
2. **Implement streaming** for transcript analysis and AI responses
3. **Use search params** for filtering, sorting, and sharing UI state
4. **Add optimistic updates** for better perceived performance
5. **Implement deferred loading** for progressive rendering of huddle data
6. **Add per-route head metadata** for SEO and dynamic titles

The app has a solid foundation with TanStack Router, Query, and Start, but there's significant room to leverage more advanced features for better UX and developer experience.

